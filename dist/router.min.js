var n;!function(n){let t;!function(n){n.Transition="Transition"}(t=n.Events||(n.Events={}))}(n||(n={}));const t=/:\w[\w\d_]*(<[^>]+>)?/g;function e(n){const e=n.match(t)||[];for(let t=0;t<e.length;t++){const r=e[t],o=r.slice(r.indexOf("<")+1,r.length-1);n=n.replace(o,encodeURIComponent(o))}return n}function r(n){return decodeURIComponent(n.replace(/^#/,""))}function o(n){if(":"===n[0]){let t=null;const e=n.indexOf("<");let r=n.slice(1,n.length);if(e>=0){if(">"!==n[n.length-1])throw new Error("No closing >");const o=n.slice(e+1,n.length-1);t=new RegExp(`^(${o})$`),r=n.slice(1,e)}return function(n,e,o=!1){return e[r]=o?[].concat(e[r]||[],n):n,!(t&&!t.test(n))}}return function(t){return t===n}}function i(n){return n.endsWith("*")}function c(n){return n.endsWith("?")}function u(n){return c(n)||i(n)?n.slice(0,-1):n}function a(n){return new URL("ftp://x/"+n)}function s(n){return n.replace(/(\/$)|(^\/)/g,"")}function f(n){return s(n).split("/").map(decodeURIComponent)}function l(n){if("/"!==n[0])throw new Error("Must start with /");const t=a(e(s(n))),l=f(s(t.pathname)),h=r(t.hash),d=function(n){const t=Array.from(n.keys()),e=t.map((t=>o(n.get(t))));return function(n,r){const o=Array.from(n.keys());if(!t.every((n=>c(n)||i(n)||o.includes(n))))return!1;for(let o=0;o<t.length;o++){const a=u(t[o]);if(i(t[o]))Array.from(n.entries()).filter((n=>n[0]===a)).forEach((n=>e[o](n[1],r,!0)));else if(!e[o](n.get(a),r)&&!c(t[o]))return!1}return!0}}(t.searchParams),p=function(n){const t=n.map(o);return function(e,r){if(n.length!==e.length)return!1;for(let o=0;o<n.length;o++)if(!t[o](e[o],r))return!1;return!0}}(l),m=o(h);return function(n){const t=new URL(n),e={};return p(f(s(t.pathname)),e)&&d(t.searchParams,e)&&m(r(t.hash),e)?e:null}}function h(n,e){const r=n.match(t)||[];for(let t=0;t<r.length;t++){const o=r[t],u=o.indexOf("<");let a=o.slice(1,u<0?o.length:u);if((c(a)||i(a))&&(a=a.slice(0,-1)),!(a in e))throw new Error(a+" undefined");n=n.replace(o,e[a])}return n}function d(n){const t=a(e(s(n))),r=f(t.pathname);return function(n){const e=a("");return e.pathname=r.map((t=>h(t,n))).join("/"),t.searchParams.forEach(((t,r)=>{const o=u(r);i(r)?[].concat(n[o]).filter(Boolean).forEach((t=>{e.searchParams.append(o,h(t,n))})):c(r)&&!n[o]||e.searchParams.set(o,h(t,n))})),e.hash=h(decodeURIComponent(t.hash),n),(""+e).replace("ftp://x","")}}function p(n){return n?{name:n.route.name,params:n.params}:null}function m({last:n,next:t,type:e}){return{last:p(n),next:p(t),type:e}}function w(t,e,r=function(){const n=[];return{emit:function(t,e){let r;for(r of n)r.type===t&&r.handler(e)},off:function(t,e){const r=n.findIndex((n=>t===n.type&&e===n.handler));-1!==r&&n.splice(r,1)},on:function(t,e){const r={handler:e,type:t};n.push(r)}}}()){const o=s(t),i={};[["root","/"],["notFound","/404"],...Object.entries(e)].forEach((([n,t])=>h(n,t)));let c=u(window.location.href);return f(c.route.name,c.params),window.addEventListener("popstate",a),{back:function(){window.history.go(-1)},destroy:function(){window.removeEventListener("popstate",a)},...r,forward:function(){window.history.go(1)},getCurrentRoute:function(){return p(c)},go:function(n){window.history.go(n)},push:f,register:h,replace:function(n,t={}){const e=i[n];if(!e)return w(i[404]);w(e,t,!0)}};function u(n){let t=null;const e=Object.values(i).find((e=>(t=e.decodeURL(n),null!==t)));return e?{params:t,route:e}:{params:null,route:i.notFound}}function a(){const t=c;c=u(window.location.href),r.emit(n.Events.Transition,m({last:t,next:c,type:n.Events.Transition}))}function f(n,t={}){const e=i[n];if(!e)return w(i[404]);w(e,t)}function h(n,t){return void 0===t||void 0===n?null:(i[n]=function(n,t){return{decodeURL:l(t),encodeURL:d(t),name:n}}(n,`${o}${t}`),!0)}function w(t,e={},o=!1){let u;try{u=t.encodeURL(function(n){for(let t in n)if(n.hasOwnProperty(t))if(Array.isArray(n[t]))for(let e=0;e<n[t].length;e++)n[t][e]=n[t][e].toString();else n[t]=n[t]?n[t].toString():null;return n}(e))}catch(n){return w(i.notFound)}if(!u)return w(i.notFound);const a=`${window.location.origin}${u}`;if(a===window.location.href)return;const s=c;c={params:e,route:t},o?window.history.replaceState({name:t.name,params:e},"",a):window.history.pushState({name:t.name,params:e},"",a),r.emit(n.Events.Transition,m({last:s,next:c,type:n.Events.Transition}))}}export{w as createRouter};
